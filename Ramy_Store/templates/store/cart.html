<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-icons.min.css') }}">
    <style>
        .back-to-top {
            position: fixed;
            left: 20px;
            /* ÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ø§Ù„ÙŠØ³Ø§Ø± */
            bottom: 30px;
            /* Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ */
            color: white;
            font-size: 12px;
            padding: 10px 14px;
            border-radius: 50%;
            text-align: center;
            text-decoration: none;
            display: none;
            /* Ù…Ø®ÙÙŠØ© Ø¨Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
            z-index: 1000;
            transition: background-color 0.3s, transform 0.3s;
        }

        .back-to-top:hover {
            transform: translateY(-2px);
        }

        @media screen and (max-width: 768px) {
            .back-to-top {
                font-size: 20px;
                padding: 10px 14px;
                left: 15px;
                /* Ø¶Ø¨Ø· Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
                bottom: 20px;
            }
        }
    </style>
</head>

<body dir="rtl">
    <div class="container-fluid bg-light py-3 shadow-sm">
        <div class="d-flex align-items-center justify-content-between">
            <h1 class="display-5 m-0">ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h1>
            <ul class="nav navbar align-items-center">
                <div class="d-flex align-items-center">
                    <span class="me-2">{{user_name.username}}</span>
                    <img src="{{ url_for('static', filename='images/user_avatar.png') }}" alt="avatar" width="40"
                        height="40" class="rounded-circle">
                </div>
                <a href="{{ url_for('store.index') }}" class="btn btn-outline-primary rounded-3 text-nowrap ms-0 me-3"
                    style=" 
            padding: 7px 14px; font-size: 0.95rem; height: 38px;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</a>
            </ul>
        </div>
    </div>

    <main class="container py-4" dir="rtl">
        {% if not cart_items %}
        <!-- Empty cart state -->
        <div class="text-center py-5">
            <p class="fs-5 text-muted">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©</p>
        </div>
        {% else %}
        <!-- Cart items -->
        <div class="cart-items">
            {# Ù…ØªØºÙŠØ± Ù„Ø§Ø¯Ø®Ø§Ù„ Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø© #}
            {% set ns = namespace(total=0) %}
            {% for item in cart_items %}
            <div class="row align-items-center py-3 border border-2 rounded-3">
                <!-- Product image (right side) -->
                <div class="col-auto">
                    <img src="{{ url_for('static', filename=item['image_url']) }}" alt="{{ item.product_name }}"
                        class="img-fluid rounded" style="width: 64px; height: 64px; object-fit: cover;">
                </div>

                <!-- Product name and price (middle) -->
                <div class="col mb-2">
                    <div class="fw-semibold">{{ item.product_name }}</div>
                    <div class="text-primary small">{{ item.price }} Ø¯ÙˆÙ„Ø§Ø±</div>
                    {% set ns.total = ns.total + item.price %}
                    <div class="text-muted small" style="direction: ltr; text-align: right;">
                        {{ (item.added_at + timedelta(hours=3)).strftime('%Y-%m-%d %I:%M%p')}} :ØªÙ…Øª Ø§Ù„Ø§Ø¶Ø§ÙÙ‡ ÙÙŠ
                    </div>
                </div>

                <!-- Delete button (left side) -->
                <div class="col-auto">
                    <!-- Ø§Ù„ÙÙˆØ±Ù… Ù…Ø¹ Ø²Ø± ÙŠÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
                    <form id="delete-form-{{ item['cart_item_id'] }}" class="delete-form"
                        action="{{ url_for('store.delete_item_from_cart', item_id=item['cart_item_id']) }}"
                        method="POST">
                        {{ form.hidden_tag() if form is defined else '' }}
                        <button type="button" class="btn btn-sm rounded-circle" data-bs-toggle="modal"
                            data-bs-target="#confirmDeleteModal-{{ item['cart_item_id'] }}" title="Ø­Ø°Ù">
                            <img src="{{ url_for('static', filename='icons/trash3.svg') }}" alt="trash-icon">
                        </button>
                    </form>

                    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯ -->
                    <div class="modal fade" id="confirmDeleteModal-{{ item['cart_item_id'] }}" tabindex="-1"
                        aria-labelledby="confirmDeleteLabel-{{ item['cart_item_id'] }}" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="confirmDeleteLabel-{{ item['cart_item_id'] }}">ØªØ£ÙƒÙŠØ¯
                                        Ø§Ù„Ø­Ø°Ù</h5>
                                </div>
                                <div class="modal-body">
                                    Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ '<strong>{{ item.product_name }}</strong>' Ù…Ù†
                                    Ø§Ù„Ø³Ù„Ø©ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                                    <button type="button" class="btn btn-danger"
                                        onclick="document.getElementById('delete-form-{{ item.cart_item_id }}').submit();">
                                        Ø­Ø°Ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}

            {% if cart_items %}

            <!-- Cart summary and checkout button -->
            <div class="mt-4">
                <div class="card shadow-sm border-0">
                    <div class="card-body">

                        <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
                        <div class="d-flex justify-content-start align-items-center gap-1 mb-3 ">
                            <span class="fs-5 fw-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span class="fs-5 text-primary fw-semibold">{{ "{:,.2f}".format(ns.total) }} Ø¯ÙˆÙ„Ø§Ø±</span>
                        </div>

                        <hr class="my-3">

                        <!-- Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© -->
                        <a href="{{ url_for('store.payment_step') }}"
                            class="btn btn-primary w-100 py-2 fs-6 fw-semibold">
                            Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙØ¹
                        </a>

                    </div>
                </div>
            </div>

            {% endif %}
    </main>

    <a href="#" class="back-to-top" id="backToTop">
        <img src="{{ url_for('static', filename='icons/arrow-up-square.svg') }}" alt="arrow-up-square.svg" height="40px"
            width="40px">
    </a>

    <script>
        const backToTopButton = document.getElementById("backToTop");

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø£ÙƒØ«Ø± Ù…Ù† 100px
        window.addEventListener("scroll", () => {
            if (window.scrollY > 100) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        });

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·ØŒ ØµØ¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø¨Ø³Ù„Ø§Ø³Ø©
        backToTopButton.addEventListener("click", (e) => {
            e.preventDefault();
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

</body>

</html>